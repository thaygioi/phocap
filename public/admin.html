<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Qu·∫£n tr·ªã tuy·ªÉn sinh</title>

  <!-- Supabase JS v2 -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      padding: 20px;
      background: #f7f7f7;
    }
    h2 {
      margin-bottom: 15px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      background: #fff;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #eee;
    }
    select {
      padding: 4px;
    }
    .status {
      min-width: 130px;
    }
  </style>
</head>

<body>

<h2>üìã Danh s√°ch ƒëƒÉng k√Ω tuy·ªÉn sinh</h2>

<table>
  <thead>
    <tr>
      <th>H·ªçc sinh</th>
      <th>Ng√†y sinh</th>
      <th>Ph·ª• huynh</th>
      <th>SƒêT</th>
      <th>L·ªõp</th>
      <th>Tr·∫°ng th√°i</th>
    </tr>
  </thead>
  <tbody id="data">
    <!-- d·ªØ li·ªáu render ·ªü ƒë√¢y -->
  </tbody>
</table>

<script>
  /* ==============================
     1. KH·ªûI T·∫†O SUPABASE (ƒê√öNG C√ÅCH)
     ============================== */

  const supabaseClient = supabase.createClient(
    "https://zxhxjvurrdfioskgbjvw.supabase.co",
    "sb_publishable_e-hT6FP8zxiVSU_TYKhqKa_r4FLQ4Ss"
  );

  /* ==============================
     2. LOAD DANH S√ÅCH H·ªí S∆†
     ============================== */

  async function loadData() {
    const { data, error } = await supabaseClient
      .from("applications")
      .select("*")
      .order("created_at", { ascending: false });

    if (error) {
      console.error("L·ªói l·∫•y d·ªØ li·ªáu:", error);
      alert("Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu!");
      return;
    }

    const tbody = document.getElementById("data");
    tbody.innerHTML = "";

    data.forEach(row => {
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${row.full_name || ""}</td>
        <td>${row.birthday || ""}</td>
        <td>${row.parent_name || ""}</td>
        <td>${row.phone || ""}</td>
        <td>${row.grade_applied || ""}</td>
        <td>
          <select class="status"
                  onchange="updateStatus('${row.id}', this.value)">
            <option ${row.status === 'Ch∆∞a x·ª≠ l√Ω' ? 'selected' : ''}>
              Ch∆∞a x·ª≠ l√Ω
            </option>
            <option ${row.status === 'ƒê√£ ti·∫øp nh·∫≠n' ? 'selected' : ''}>
              ƒê√£ ti·∫øp nh·∫≠n
            </option>
            <option ${row.status === 'ƒê√£ duy·ªát' ? 'selected' : ''}>
              ƒê√£ duy·ªát
            </option>
          </select>
        </td>
      `;

      tbody.appendChild(tr);
    });
  }

  /* ==============================
     3. C·∫¨P NH·∫¨T TR·∫†NG TH√ÅI
     ============================== */

  async function updateStatus(id, status) {
    const { error } = await supabaseClient
      .from("applications")
      .update({ status })
      .eq("id", id);

    if (error) {
      console.error("L·ªói c·∫≠p nh·∫≠t:", error);
      alert("Kh√¥ng c·∫≠p nh·∫≠t ƒë∆∞·ª£c tr·∫°ng th√°i!");
    }
  }

  /* ==============================
     4. LOAD KHI M·ªû TRANG
     ============================== */

  loadData();
</script>

</body>
</html>
