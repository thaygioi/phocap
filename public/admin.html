<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Quáº£n trá»‹ tuyá»ƒn sinh</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #f2f2f2; }
    select { padding: 4px; }
    .login { max-width: 300px; margin: 50px auto; }
  </style>
</head>
<body>

<h2>ğŸ“‹ Quáº£n trá»‹ tuyá»ƒn sinh Ä‘áº§u cáº¥p</h2>

<div id="loginBox" class="login">
  <h3>ÄÄƒng nháº­p Admin</h3>
  <input id="email" placeholder="Email" /><br><br>
  <input id="password" type="password" placeholder="Máº­t kháº©u" /><br><br>
  <button onclick="login()">ÄÄƒng nháº­p</button>
  <p id="loginMsg"></p>
</div>

<div id="adminBox" style="display:none;">
  <button onclick="logout()">ÄÄƒng xuáº¥t</button>
  <br><br>
  <table>
    <thead>
      <tr>
        <th>Há»c sinh</th>
        <th>NgÃ y sinh</th>
        <th>Phá»¥ huynh</th>
        <th>SÄT</th>
        <th>Tráº¡ng thÃ¡i</th>
      </tr>
    </thead>
    <tbody id="data"></tbody>
  </table>
</div>

<script>
  const supabase = supabase.createClient(
    "https://zvhxivunrffjoskqbivw.supabase.co",
    "sb_publishable_e-hT6FP8ZxiVSU_TYKHqkA_r4FLQ4Ss"
  );

  async function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    const { error } = await supabase.auth.signInWithPassword({ email, password });
    document.getElementById("loginMsg").innerText =
      error ? error.message : "ÄÄƒng nháº­p thÃ nh cÃ´ng";

    if (!error) loadData();
  }

  async function logout() {
    await supabase.auth.signOut();
    location.reload();
  }

  async function loadData() {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("adminBox").style.display = "block";

    const { data, error } = await supabase
      .from("applications")
      .select("*")
      .order("created_at", { ascending: false });

    if (error) {
      alert(error.message);
      return;
    }

    const tbody = document.getElementById("data");
    tbody.innerHTML = "";

    data.forEach(row => {
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${row.full_name}</td>
        <td>${row.birthday}</td>
        <td>${row.parent_name}</td>
        <td>${row.phone}</td>
        <td>
          <select onchange="updateStatus('${row.id}', this.value)">
            <option ${row.status === 'ChÆ°a xá»­ lÃ½' ? 'selected' : ''}>ChÆ°a xá»­ lÃ½</option>
            <option ${row.status === 'ÄÃ£ tiáº¿p nháº­n' ? 'selected' : ''}>ÄÃ£ tiáº¿p nháº­n</option>
            <option ${row.status === 'ÄÃ£ duyá»‡t' ? 'selected' : ''}>ÄÃ£ duyá»‡t</option>
          </select>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  async function updateStatus(id, status) {
    const { error } = await supabase
      .from("applications")
      .update({ status })
      .eq("id", id);

    if (error) alert(error.message);
  }

  supabase.auth.getSession().then(({ data }) => {
    if (data.session) loadData();
  });
</script>

</body>
</html>

